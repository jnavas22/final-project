<html>
<head>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/bootstrap.css">
<style>
body, html {height: 100%}

table.center {
    margin-left:auto; 
    margin-right:auto;
  }

</style>
</head>
<body> 
<div align="center">
  <div>
    <h1>
      <%= @current_user.first_name%>'s Sent Roommate Inquiries
    </h1>
  </div>
</div>

<% @my_sent_requests = RoommateRequest.where({ :sender_id => @current_user.id})%>

<hr>
<div>
  <div align="center">
    <table  class = "table table-hover" border="0" style="width:80%">
      <tr class="table-warning">
        <th>
        Picture
        </th>
        <th >
          First Name
        </th>
        <th >
          Last Name
        </th>
         <th >
          University
        </th>
          <th >
          Current City
        </th>
           <th >
          Expected Move-in date
        </th>
        <th>
          Added When
        </th>
        <th>
          Status
        </th>
        <th>
          Show More
        </th>
        <th>
          Delete
        </th>
      </tr>
      <% @my_sent_requests.each do |a_roommate_request| %>
        <% @this_request = User.where({ :id => a_roommate_request.recipient_id}).at(0) %>
       <% @this_request_preferences = Preference.where({ :user_id => a_roommate_request.recipient_id}).at(0) %>
       <td>
        <div style="display: flex; justify-content: center;">
        <img src="<%= @this_request_preferences.picture %>" class="img-responsive"  style="max-width: 100%;">
        </div>
        </td>

        <td>
          <%= @this_request.first_name %>
        </td>

        <td>
            <%= @this_request.last_name %>
        </td>
         <td>
            <%= @this_request.university %>
        </td>
          <td>
            <%= @this_request.from_city %>
        </td>
          <td>
            <%= @this_request.movedate.strftime("%b %d, %Y") %>
        </td>

        <td>
          <%= time_ago_in_words(a_roommate_request.created_at) %> ago
        </td>
        <!--if you sent them a preference, and they sent you a preference, matched -->
        <% @requested_by_you = RoommateRequest.where({ :sender_id => @current_user.id}).where({ :recipient_id => @this_request.id}).at(0) %>
        <% @requested_to_you = RoommateRequest.where({ :recipient_id => @current_user.id}).where({ :sender_id => @this_request.id}).at(0) %>
         <% if @requested_by_you != nil && @requested_to_you != nil %>
         <td>
         <span class="badge rounded-pill bg-success">Matched</span>
         </td>
         <% else %>
         <td>
          <span class="badge rounded-pill bg-info">Pending</span>
        </td>
        <% end %>
        <td>
        <% if @requested_by_you != nil && @requested_to_you != nil %> <!-- if they've matched-->
        <a href="/personal_info/<%= a_roommate_request.id %>">Personal details</a>

         
        <% else %>
         <a href="/roommate_sent_requests/<%= a_roommate_request.id %>">
            Show details
          </a>
        <% end %>
        </td>
        <td>
           <a href = "/delete_roommate_request/<%= a_roommate_request.id %>">Delete</a>
        </td>
        </tr>
        <% end %>
    </table>
  </div>
</div>

<hr>
</body>
</html>